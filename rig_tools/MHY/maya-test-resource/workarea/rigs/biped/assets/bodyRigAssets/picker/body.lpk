var WSB;(function(n){function e(t){return(t==="SSUE"||t==="SREE")&&n.isDocSourceEnabledInQws(t)}function p(n,t){var i,r;switch(t){case"SSUE":return((i=n===null||n===void 0?void 0:n.Groups)===null||i===void 0?void 0:i.length)>0;case"SREE":return((r=n===null||n===void 0?void 0:n.EntitySets)===null||r===void 0?void 0:r.length)>0;default:return!1}}const i="NT",b="NF",k="TO",o="SubstrateSearchService",d="https://outlook.office365.com/autodiscover/autodiscover.json/v1.0/{0}?Protocol={1}",r="AutoDiscoveryKey";n.ZqSuggestionsStorageKey="3SZqSuggestionsKey";const s="gwsflt.",g="textdecorations",h="scenario",c="setflight",nt="debug",l="entitytypes",tt="1",it="scopes",rt="people.directorysearch",ut="Authorization",u="Content-Type",ft="X-AnchorMailbox",et="X-Client-Language",ot="X-Client-LocalTime",a="Client-Request-Id",v="User-Agent",st="X-Debug-ExternalExp",ht="X-Client-Flights",f="application/json",ct="WSBScopeZQ15",lt="WSBScopeZQ20",at=15,vt=6048e5,yt=n.MinuteToMs,pt=2e3;let t,y=!1;const wt="https://substrate.office.com{0}/api/v1/",bt="https://substrate.office365.us{0}/api/v1/";n.qws3SDocsEnabled=e;class w extends n.CortanaJsonDataProvider{constructor(i,u,f,e){var o;super(e||w.getDataSource(u,f));this._accessTokenManager=i;this._authType=u;this._providerType=f;let h;if(this._autoDiscoveryData={stem:"/search",timestamp:-1},!y){y=!0;let i=[],r=n=>n.split(",").filter(n=>n.toLocaleLowerCase().startsWith(s)).map(n=>n.substr(s.length));n.TestHookUrlParameters&&i.push(...((o=n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters["3sflights"])!==null&&o!==void 0?o:"").split(","));t=i.join(",");ThresholdUtilities.getCortanaHeaders(n=>{if(n){let u=n["X-BM-ClientFeatures"];if(u){let n=r(u);n.length>0&&(i.push(...n),t=i.join(","))}}})}(n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.clearAutoDCache)&&n.LightweightStorage.removeItem(r);let c=n.LightweightStorage.getItem(r);if(c){let t=n.safeExecute(()=>JSON.parse(c),"parseAutoDiscovery",null);t&&!t.errorState?this._autoDiscoveryData=t:n.LightweightStorage.removeItem(r)}n.config.msbCleanQwsDocsCache&&n.LightweightStorage.removeItem(n.ZqSuggestionsStorageKey);n.Host.bindAccountChanged(()=>{n.LightweightStorage.removeItem(n.ZqSuggestionsStorageKey)});n.Host.bindAccessTokenAvailable(t=>{if(t==this._authType){if(this._providerType==0){let t=n.getCurrentTime();if(h){let n=t-h;if(n<yt)return}h=t;this.fetchUrl(this.getSubstrateInitUrl(),null,"",()=>{},null,()=>!0)}let i=n.getCurrentDate();i.setDate(i.getDate()-1);this._autoDiscoveryData.timestamp<i.getTime()&&this.getStem()(t,t=>{t.timestamp=n.getCurrentTime(),this._autoDiscoveryData=t,t.errorState||n.LightweightStorage.setItem(r,JSON.stringify(t))})}})}getName(){return"SubstrateDataProvider "+this._dataSource}createUrl(t){if(this._providerType==1||this._providerType==2)return this.getBaseUrl();if(this._providerType==0){if(t.scope==n.Scope.Documents){let i=n.getEffectiveQuery(t);if(i!=t.queryToFetch)return this.getBaseUrl()+n.encodeQueryParameter(i.toLocaleLowerCase())}return super.createUrl(t)}throw new Error("Not implemented");}getBaseUrl(){if(this._providerType==0)return this.getSubstrateSuggestionsUrl();if(this._providerType==1)return this.getSubstrateSearchUrl();if(this._providerType==2)return this.getSubstrateRecomendationsUrl();throw new Error("Not implemented");}getClientFlights(){return this._providerType==2?"recEnableDuplicateMeetingAttachments":null}static getDataSource(n,t){if(t==0)return n==1?"SSUE":"SSUC";if(t==1)return n==1?"SSEE":"SSEC";if(t==2&&n==1)return"SREE";throw new Error("Not implemented");}getPostBody(t){if(this._providerType==1){let i,r=n.getEffectiveScope(t);switch(r){case n.Scope.Emails:let u=[{Score:{SortDirection:"Desc",Count:n.config.maxNumberOfEmailsInTopResult}},{Time:{SortDirection:"Desc"}}];i=this.buildPostBodyForQueryEndpoint(t,"Message",["Exchange"],u);break;case n.Scope.Documents:case n.Scope.All:let r;switch(n.config.queryProvenances){case 0:r=["SharePoint"];break;case 1:r=["OneDriveBusiness"];break;case 2:r=["SharePoint","OneDriveBusiness"];break;default:throw new Error("Unexpected query provenances: "+n.config.queryProvenances);}i=this.buildPostBodyForQueryEndpoint(t,"Documents",r,[{Score:"Desc"}]);break;default:throw new Error("Unsupported scope "+t.scope);}return JSON.stringify(i)}return this._providerType==2?JSON.stringify(this.buildPostBodyForRecommendationsEndpoint(t)):""}buildPostBodyForQueryEndpoint(n,t,i,r){return this.buildPostBody(t,"WindowsSearchBoxL2",undefined,n.queryToFetch,i,r,"ProvenanceOptimized","Forward")}buildPostBodyForRecommendationsEndpoint(t){if(n.config.use3sRecRecommendedFiles&&t.isSearchHomeZI)return this.buildPostBody("Document","WSB.RecommendedFiles");let i=new Date(n.getCurrentTime()).toISOString(),r=new Date(n.getCurrentTime()+at*n.MinuteToMs).toISOString();var u=[{EntityType:"Event",StartDateTime:i,EndDateTime:r,Top:2},{EntityType:"Document",Top:10}];return this.buildPostBody("Document","WSB.MeetingRelatedEntities",u)}buildPostBody(t,i,r,u,f,e,o,s){switch(i){case"WSB.RecommendedFiles":return{EntityRequests:[{}],Cvid:n.Host.getConversationId(),Scenario:{Name:i}};default:return{EntityRequests:[{Query:u?{QueryString:u}:undefined,QueryParameters:r,EntityType:t,Provenances:f,Sort:e,PropertySet:o}],Cvid:n.Host.getConversationId(),TextDecorations:s,Scenario:{Name:i}}}}getStem(){return n.Async.safeChainWithGlobalCaching("getStem",t=>ThresholdUtilities.createPromise(r=>{this._accessTokenManager.getAccount(t,n.getSubstrateResourceOrScope(t),!1,!0,t=>{if(t&&t.UserName){let e=n.formatString(d,[t.UserName,o]),i={};i[u]=f;i[a]=n.Host.getConversationId();i[v]=navigator.userAgent;let s=(t,i,u)=>{if(u){r({stem:"",errorState:u});return}let f=i;if(!f){r({stem:""});return}if(!f.Url){r({stem:"",errorState:"NAU"});return}if(f.Protocol!=o){r({stem:"",errorState:"NAP"});return}let e=n.tryParseUrl(f.Url,!0),s=e?e.path:null;if(!s){r({stem:"",errorState:"NAS"});return}r({stem:s})};super.fetchUrl(e,i,"",s,null,()=>!0)}else r({stem:"",errorState:i})},undefined,n.Host.isAuthInvestigation()?["SubstrateDataProvider::getStem"]:undefined)}),()=>"autoDiscovery")}getAllAccountTokens(t,r){let u=n.Host.isAuthInvestigation()?["SubstrateDataProvider::getAllAccountTokens"]:undefined;if(t||n.RuntimeConfig.QfMode!=5)this._accessTokenManager.getAccount(this._authType,n.getSubstrateResourceOrScope(this._authType),!1,!0,n=>{n&&n.Token?r([n]):r(null,i)},undefined,u);else{let t=SearchAppWrapper.CortanaApp.fileExplorerSuggestionPage.currentSyncRootAccount;t?this._accessTokenManager.getAccountByUserName(!0,1,t,!1,!0,n=>{n&&n.Token?r([n]):r(null,i)},u):n.isFileExplorerCurrentPathThisPcOrQuickAccess?this._accessTokenManager.getAllSyncingAccounts(!0,1,!1,!0,n=>{n.length>0?r(n):r(null,i)},u):(SharedLogHelper.LogError("fetchUrl",null,new Error("Substrate provider called without currentSyncRootAccount")),r(null,b))}}fetchUrl(t,i,r,u,f,e){if(!this._autoDiscoveryData.stem){u(this._dataSource,null,this._autoDiscoveryData.errorState,null,!0);return}let h=t==this.getSubstrateInitUrl();t=n.formatString(t,[this._autoDiscoveryData.stem]);i||(i={});let o={numOfPendingResponses:0};n.config.enableFetchStartLogging&&n.InstrumentationHelper.instrumentFetchProviderBegin(n.SequenceNumberManager.getSequenceNumber(),"SSDPU:"+this._dataSource);let s=s=>{let h=Object.assign({},i);h[ut]="Bearer "+s.Token;this._authType==1&&(n.SubstrateTenantName!==s.TenantName&&s.TenantName&&(n.SubstrateTenantName=s.TenantName),(n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.tenantName)&&(n.SubstrateTenantName=n.TestHookUrlParameters.tenantName));h[ft]=s.RoutingHint;super.fetchUrl(t,h,r,(n,t,i,r,f)=>{--o.numOfPendingResponses,u(n,t,i,r,f,o.numOfPendingResponses!=0)},f,e)};this.getAllAccountTokens(h,(n,t)=>{t?u(this._dataSource,null,t,null,null,!1):n?(o.numOfPendingResponses=n.length,n.forEach(n=>s(n))):(o.numOfPendingResponses=1,s(null))})}fetch(i,r,o,s,h,c){const nt=n.isDataSourceEnabled(this._dataSource,i);let d=!1;if(nt){if(n.config.enableFetchStartLogging&&n.InstrumentationHelper.instrumentFetchProviderBegin(o,"SSDP:"+this._dataSource),i.isSearchHomeZI&&e(this._dataSource)&&n.isMsbQwsDocsCacheEnabled(i)&&!(n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.msbSHNoRecDocs)){const t=this.getQwsDocsCachedResults();if(t.results){const i=!n.config.msbQwsDocsNoRefreshAfterCachedResults;r(this._dataSource,t.results,null,undefined,undefined,i);d=!0;typeof n.msbHost=="object"&&n.msbHost.qfUtils.incrementQwsAggregateSuccessRate(!0)}else _w.bfbWsbTel&&bfbWsbTel.logError("Wsb quick work search document cache error",t.cacheState)}let y={};y[et]=n.uiLanguageCache;y[ot]=n.getDateWithTimezone();y[v]=navigator.userAgent;typeof _CachedFlights!="undefined"&&_CachedFlights.sort&&(y[st]=_CachedFlights.sort().join(","));y[a]=n.InstrumentationHelper.getImpressionGuid(o);y[u]=f;let g=this.buildParams(c,i.scope,!i.queryToFetch);if(this._providerType!=0||g[l]){let b=this.getClientFlights();t&&(b=b?b+","+t:t);b&&(y[ht]=b);let w=null;i.isSearchHomeZI&&(w=n.safeSetTimeout(()=>{sb_ct(w),w=null,n.config.msbQwsDocsNoRefreshAfterCachedResults&&d||r(this._dataSource,null,k)},pt,"SubstrateDataProvider Fetch"));var tt=(t,u,f,o,s,h)=>{let c=parseInt(f);(c==403||c==401)&&n.safeSetTimeout(()=>this._accessTokenManager.getAccount(this._authType,n.getSubstrateResourceOrScope(this._authType),!0,!0,()=>{},undefined,n.Host.isAuthInvestigation()?["SubstrateDataProvider::onResponseReceived"]:undefined),0,"SubstrateDataProvider onResponseReceived");let l=h;if(i.isSearchHomeZI){if(n.isMsbQwsDocsCacheEnabled(i)&&!n.config.msbQwsDocsNoRefreshAfterCachedResults&&(l=!1),(n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.msbSHNoRecDocs)&&(u=null),e(t)){const r=p(u,t);let f=r&&w!=null;if(d||typeof n.msbHost!="object"||n.msbHost.qfUtils.incrementQwsAggregateSuccessRate(f),r&&n.isMsbQwsDocsCacheEnabled(i)){const i={dataSource:t,results:u,lastUpdatedTime:n.getCurrentTime()};n.LightweightStorage.setItem(n.ZqSuggestionsStorageKey,JSON.stringify(i))}}if(w==null)return;if(sb_ct(w),w=null,n.config.msbQwsDocsNoRefreshAfterCachedResults&&d)return}r(t,u,f,o,s,l)};super.fetch(i,tt,o,s,h,g,y)}}}getSubstrateBaseUrl(){return _w.BingAtWork&&_w.BingAtWork.wsb&&_w.BingAtWork.wsb.gccRegion===2?bt:wt}getSubstrateEventsUrl(){return this.getSubstrateBaseUrl()+"events"}getSubstrateInitUrl(){return this.getSubstrateBaseUrl()+"init"}getSubstrateSuggestionsUrl(){return this.getSubstrateBaseUrl()+"suggestions?query="}getSubstrateSearchUrl(){return this.getSubstrateBaseUrl()+"query"}getSubstrateRecomendationsUrl(){return this.getSubstrateBaseUrl()+"recommendations"}getQwsDocsCachedResults(){let t={results:null,cacheState:n.MsbQfCacheState.Empty},i;const r=n.LightweightStorage.getItem(n.ZqSuggestionsStorageKey);if(!r)return t;try{i=JSON.parse(r)}catch(u){const i=`[MSB.Error]  QWS docs cache is broken.
                            cacheString=${r},
                            error.message=${u===null||u===void 0?void 0:u.message}`;t.cacheState=n.MsbQfCacheState.Error;n.LightweightStorage.removeItem(n.ZqSuggestionsStorageKey)}return i&&i.dataSource==this._dataSource&&(n.getCurrentTime()-i.lastUpdatedTime<vt?p(i.results,this._dataSource)?(t.results=i.results,t.cacheState=n.MsbQfCacheState.ValidResults):t.cacheState=n.MsbQfCacheState.NoResults:(n.LightweightStorage.removeItem(n.ZqSuggestionsStorageKey),t.cacheState=n.MsbQfCacheState.Expired)),t}buildParams(t,i,r){var f,u={};if(this._providerType==0&&(u[n.Service.QueryParams.ConversationId]=t[n.Service.QueryParams.ConversationId],u[g]=tt,this._authType!=1||r||i!=n.Scope.People?i!=n.Scope.All&&(u[h]=it):u[h]=rt,r&&this._authType==1&&t[n.Service.QueryParams.ImpressionGuid]&&(u[n.Service.QueryParams.LogicalId]=t[n.Service.QueryParams.ImpressionGuid]),u[l]=this.getEntityTypes(i,r),i==n.Scope.Documents&&r&&n.config.msbEnableDocumentZQ&&(u[c]=n.config.msbDocumentZQResultsCount==20?lt:ct)),n.TestHookUrlParameters){let t=(f=n.TestHookUrlParameters["3sflights"])!==null&&f!==void 0?f:"";t&&(u[c]=t);n.TestHookUrlParameters["3sdebug"]&&(u[nt]="1")}return u}getEntityTypes(t,i){let r;switch(t){case n.Scope.Documents:r="Documents";break;case n.Scope.People:r="People";break;case n.Scope.All:let u=[];if(this._authType==1&&u.push("Documents"),!i&&n.RuntimeConfig.QfMode!=5){let t=typeof n.msbHost=="object"&&n.msbHost.tenantManager.isTenantMsbEnabled();t||u.push("People")}r=u.join(",");break;default:throw new Error("Unsupported scope "+t);}return r}instrumentClick(t,i){if(t&&i){let e=[{Key:t,Value:[{Name:"entityclicked",Attributes:[{Key:"id",Value:i},{Key:"localtime",Value:n.getDateWithTimezone()}]}]}],r={};r[u]=f;this.fetchUrl(this.getSubstrateEventsUrl(),r,JSON.stringify(e),()=>{},null,()=>!0)}}}n.SubstrateDataProvider=w})(WSB||(WSB={})),function(n){function y(t,i,r){let u=n.OfficeTypeExtensionConfigs[t];u?n.LocalDataProvider.getApps(u.appIds,t=>{let f=!n.Map.isEmpty(t);f?i(u.uri):r()}):r()}function s(t,i,r){let u=t?new URL(t):null;!u||u.pathname&&u.pathname.indexOf(":")!=-1?n.Host.launchUri(i):y(r,i=>n.Host.launchUri(i+t),()=>n.Host.launchUri(i))}function p(t,i,r){n.setExtraVerbs(t,()=>{let u=[];return u.push({verb:n.JumplistActionItemType[n.JumplistActionItemType.S_OpenInBrowser],displayName:n.Host.getLocString("OpenInBrowser"),executeSync:()=>n.Host.launchUri(i),icon:{type:1,content:"&#xE774"}}),t.locationUrl&&u.push({verb:n.JumplistActionItemType[n.JumplistActionItemType.S_OpenFileLocationInBrowser],displayName:n.Host.getLocString("OpenFileLocationIn",r),executeSync:()=>n.Host.launchUri(t.locationUrl),icon:{type:2,content:"&#xE838"}}),t.url&&SearchAppWrapper.CortanaApp.copyToClipboard&&u.push({verb:n.JumplistActionItemType[n.JumplistActionItemType.S_CopyFullPath],displayName:n.Host.getLocString("CopyFullPath"),executeSync:()=>SearchAppWrapper.CortanaApp.copyToClipboard(t.url,""),icon:{type:1,content:"&#xE8C8"}}),u},!1)}function h(t,i,r,u,e,o,h,c,l,a,v,y,w,b,k,d,g,nt,tt,it,rt){let ot=n.ScopeConfig[n.Scope.Documents].icon;u||(u=r+"?web=1");o=HitHighlightingParser.removeMarkers(o);h&&(h=h.toLocaleLowerCase());let et="FL",ut=n.createSuggestion(i,e,h&&n.getIconForTypeAsync(ot,"."+h),ot,et,o,n.InstrumentedItem.createInstrumentedItem(d,et),8,d,!0);ut.instrumentPingBack=k;let ht=n.isZeroInputAllScope(i);ut.click=()=>{ht&&_w.bfbWsbTel&&bfbWsbTel.logSearchHomeClick("Documents"),s(r,u,h)};ut.extensionLC="."+h;ut.lastModifiedDate=n.toDate(l);ut.lastModifiedBy=a;ut.lastAccessDate=n.toDate(v);ut.author=y;ut.matchedOnlyOnAuthor=w;ut.matchedOnlyOnContent=b;ut.textContentIfMatched=tt;ut.siteTitle=rt;ut.url=r;let st=c=="OneDriveBusiness"?3:c=="SharePoint"?4:undefined,ct=n.nicerCloudFilesEnabled(i,ut);n.setDocumentLocationProperties(ut,o,c,ct);w?ut.match=n.createMatch(n.MatchType.Author,y):e.includes(HitHighlightingParser.startMarker)||(ut.match=n.tryGetLocationMatch(ut.path,g)||it);i.isSearchHomeZI||(ut.sourceForGroup=st);const ft=new Date(n.getCurrentDate().toUTCString());if(t){ut.meeting=t;ut.features.push("MeetingRecommendation");const i=new Date(t.Start),r=Math.floor((i.getTime()-ft.getTime())/n.MinuteToMs);ut.explanation=r>0?n.Host.getLocString("DocumentRelatedToMeeting",HitHighlightingParser.addMarkers(t.Subject.trim()),f(ft,new Date(t.Start))):n.Host.getLocString("DocumentRelatedToMeetingNow",HitHighlightingParser.addMarkers(t.Subject.trim()))}else if(i.isSearchHomeZI){let t=ut.lastModifiedBy&&ut.lastModifiedDate&&(!ut.lastAccessDate||ut.lastModifiedDate>=ut.lastAccessDate)?f(ut.lastModifiedDate,ft):null;if(t)ut.explanation=n.Host.getLocString("DocumentLastModifiedBy",HitHighlightingParser.addMarkers(ut.lastModifiedBy),t);else if(ut.lastAccessDate){let t=f(ut.lastAccessDate,ft);t&&(ut.explanation=n.Host.getLocString("DocumentLastAccessed",HitHighlightingParser.addMarkers(n.Host.getLocString("YouLabel")),t))}}return n.setFileTemplate(i,g,nt,ut),p(ut,u,n.getGroupSourceDisplayName(st)),ut.reactKey=et+e+y+r,ut.classNames.push("fbig"),ut}function f(t,i){if(!t||!i)return null;const r=i.getTime()-t.getTime();if(r<0)return null;const u=r/n.DayToMs;if(u>=1)return n.Host.getLocString("TimeDayShorthandPattern",Math.floor(u).toString());const f=r/n.HourToMs;if(f>=1)return n.Host.getLocString("TimeHourShorthandPattern",Math.floor(f).toString());const e=r/n.MinuteToMs;return n.Host.getLocString("TimeMinuteShorthandPattern",Math.floor(e).toString())}const r={Word:{appIds:["Microsoft.Office.WINWORD.EXE.15","Microsoft.Office.WINWORD.EXE.16","{6D809377-6AF0-444B-8957-A3773F02200E}\\Microsoft Office\\Office15\\WINWORD.EXE","{7C5A40EF-A0FB-4BFC-874A-C0F2E0B9FA8E}\\Microsoft Office\\Office15\\WINWORD.EXE","{6D809377-6AF0-444B-8957-A3773F02200E}\\Microsoft Office\\Office16\\WINWORD.EXE","{7C5A40EF-A0FB-4BFC-874A-C0F2E0B9FA8E}\\Microsoft Office\\Office16\\WINWORD.EXE","Microsoft.Office.Word_8wekyb3d8bbwe!microsoft.word"],uri:"ms-word:ofe|u|"},Excel:{appIds:["Microsoft.Office.EXCEL.EXE.15","Microsoft.Office.EXCEL.EXE.16","{6D809377-6AF0-444B-8957-A3773F02200E}\\Microsoft Office\\Office15\\EXCEL.EXE","{7C5A40EF-A0FB-4BFC-874A-C0F2E0B9FA8E}\\Microsoft Office\\Office15\\EXCEL.EXE","{6D809377-6AF0-444B-8957-A3773F02200E}\\Microsoft Office\\Office16\\EXCEL.EXE","{7C5A40EF-A0FB-4BFC-874A-C0F2E0B9FA8E}\\Microsoft Office\\Office16\\EXCEL.EXE","Microsoft.Office.Excel_8wekyb3d8bbwe!microsoft.excel"],uri:"ms-excel:ofe|u|"},PowerPoint:{appIds:["Microsoft.Office.POWERPNT.EXE.15","Microsoft.Office.POWERPNT.EXE.16","{6D809377-6AF0-444B-8957-A3773F02200E}\\Microsoft Office\\Office15\\POWERPNT.EXE","{7C5A40EF-A0FB-4BFC-874A-C0F2E0B9FA8E}\\Microsoft Office\\Office15\\POWERPNT.EXE","{6D809377-6AF0-444B-8957-A3773F02200E}\\Microsoft Office\\Office16\\POWERPNT.EXE","{7C5A40EF-A0FB-4BFC-874A-C0F2E0B9FA8E}\\Microsoft Office\\Office16\\POWERPNT.EXE","Microsoft.Office.PowerPoint_8wekyb3d8bbwe!microsoft.pptim"],uri:"ms-powerpoint:ofe|u|"},Visio:{appIds:["{7C5A40EF-A0FB-4BFC-874A-C0F2E0B9FA8E}\\Microsoft Office\\Office15\\VISIO.EXE","{7C5A40EF-A0FB-4BFC-874A-C0F2E0B9FA8E}\\Microsoft Office\\Office14\\VISIO.EXE","{6D809377-6AF0-444B-8957-A3773F02200E}\\Microsoft Office\\Office16\\VISIO.EXE","{7C5A40EF-A0FB-4BFC-874A-C0F2E0B9FA8E}\\Microsoft Office\\Office16\\VISIO.EXE","Microsoft.Office.VISIO.EXE.15"],uri:"ms-visio:ofe|u|"},OneNote:{appIds:["Microsoft.Office.ONENOTE.EXE.15","Microsoft.Office.ONENOTE.EXE.16","{6D809377-6AF0-444B-8957-A3773F02200E}\\Microsoft Office\\Office15\\ONENOTE.EXE","{7C5A40EF-A0FB-4BFC-874A-C0F2E0B9FA8E}\\Microsoft Office\\Office15\\ONENOTE.EXE","{6D809377-6AF0-444B-8957-A3773F02200E}\\Microsoft Office\\Office16\\ONENOTE.EXE","{7C5A40EF-A0FB-4BFC-874A-C0F2E0B9FA8E}\\Microsoft Office\\Office16\\ONENOTE.EXE","Microsoft.Office.OneNote_8wekyb3d8bbwe!microsoft.onenoteim"],uri:"onenote:"}},e="sip:",c=["Microsoft.Office.lync.exe.15","{6D809377-6AF0-444B-8957-A3773F02200E}Microsoft OfficeOffice15lync.exe","{6D809377-6AF0-444B-8957-A3773F02200E}Microsoft OfficeOffice16lync.exe","{7C5A40EF-A0FB-4BFC-874A-C0F2E0B9FA8E}Microsoft OfficeOffice15lync.exe","{7C5A40EF-A0FB-4BFC-874A-C0F2E0B9FA8E}Microsoft OfficeOffice16lync.exe","{6D809377-6AF0-444B-8957-A3773F02200E}MSOfficeOffice15lync.exe","{6D809377-6AF0-444B-8957-A3773F02200E}MSOfficeOffice16lync.exe","{7C5A40EF-A0FB-4BFC-874A-C0F2E0B9FA8E}MSOfficeOffice15lync.exe","{7C5A40EF-A0FB-4BFC-874A-C0F2E0B9FA8E}MSOfficeOffice16lync.exe","Microsoft.Office.Desktop_8wekyb3d8bbwe!Lync","com.squirrel.Teams.Teams",],t=r.Word,i=r.Excel,u=r.PowerPoint,o=r.Visio,l="https://gcchigh.loki.office365.us/api/v1/configuration/cortana",a="https://loki.delve.office.com/api/v1/configuration/cortana";n.OfficeTypeExtensionConfigs={doc:t,dot:t,dotx:t,docx:t,docm:t,docb:t,xls:i,xlm:i,xlsx:i,xlsm:i,xlsb:i,xltx:i,ppt:u,pps:u,pptx:u,pptm:u,vsd:o,vsdx:o,one:r.OneNote};class v{constructor(n,t,i,r){this._substrateSuggestionsDataProvider=n;this._accessTokenManager=t;this._substrateProfilePictureProvider=i;this._authType=r;this._mailboxLocations={}}parse(t,i,r,u,f,e){if(n.isDataSourceEnabled(r,t)){let o=[];if(!u||!u.Groups){e(r,o,null);return}let s=r=="SSUE"?n.config.aadPeopleCardHandoffEnabled&&!(typeof n.msbHost=="object"&&n.msbHost.tenantManager.isTenantMsbEnabled()):n.config.msaPeopleCardHandoffEnabled,y=n.getEffectiveQuery(t),l=n.isL2(t);const a=n.config.msbQws3sSugHideTimestamp&&t.isSearchHomeZI;let v=c=>{for(let e of u.Groups)if(e.Suggestions&&e.Suggestions.length)switch(e.Type){case"Documents":let v=e.Suggestions;for(let r of v){let f=n.safeExecute(()=>h(undefined,t,r.AccessUrl||r.Url,null,r.Text,r.FileName,r.FileExtension,r.FileSourceType=="OneDriveForBusiness"?"OneDriveBusiness":"SharePoint",a?null:r.DateModified?r.DateModified+"Z":null,r.ModifiedByDisplayName,a?null:r.DateAccessed?r.DateAccessed+"Z":null,r.CreatedBy||HitHighlightingParser.removeMarkers(r.Author),r.PropertyHits&&r.PropertyHits[0]=="Author",!1,()=>this._substrateSuggestionsDataProvider.instrumentClick(u.Instrumentation.TraceId,r.ReferenceId),i,y,l,"",null,r.SourceTitle),"buildSubstrateDocumentSuggestion");if(f&&n.isValidSuggestion(f,"SubstrateDocumentsSuggestionsParser")&&(o.push(f),t.isSearchHomeZI&&typeof n.msbHost=="object"&&n.msbHost.enableQws()&&n.isMsbEnterprise()&&!n.msbHost.tenantManager.isGccHighTenant()&&o.length>=(n.config.msbEnableDocumentZQ&&t.scope==n.Scope.Documents?n.config.msbDocumentZQResultsCount:n.config.ziRecommendedDocsResultsParseCount)))break}t.isSearchHomeZI||n.decorateSuggestionsWithParentFolder(o);break;case"People":let p=e.Suggestions;for(let f of p){let e=n.safeExecute(()=>this.buildPersonSuggestion(s,f,i,u.Instrumentation.TraceId,l,r,t,c),"buildPersonSuggestion");e&&n.isValidSuggestion(e,"SubstratePeopleSuggestionsParser")&&o.push(e)}s&&n.safeExecute(()=>this.prefetchPeopleCards(o.filter(n=>n.type=="PPL"),i,f),"prefetchPeopleCards");n.isL2(t)||this.decorateContactsWithSameDisplayName(o,t);break;default:SharedLogHelper.LogError("parseSubstrateResponse",e.Type,new Error("Unexpected group type"))}t.isSearchHomeZI&&t.scope===n.Scope.All&&typeof n.msbHost=="object"&&n.msbHost.enableQws()&&(o===null||o===void 0?void 0:o.length)>0&&_w.bfbWsbTel&&bfbWsbTel.logSearchHomeImpression("Documents");e(r,o,null)};r=="SSUE"?n.LocalDataProvider.getApps(c,t=>v(!n.Map.isEmpty(t))):v(!1)}}prefetchPeopleCards(t,i,r){t.length&&this.getPeopleCardTokenAndMailboxLocation(u=>{if(u&&u.token&&u.location&&i==n.SequenceNumberManager.getSequenceNumber()&&r()){let o=u.location+"api/v1/personacards/preparePersona",f=SearchAppWrapper.CortanaApp.createStringMap();f.Authorization="Bearer "+u.token;f["X-ClientCorrelationId"]=n.InstrumentationHelper.getImpressionGuid(i);f["X-ClientType"]="6";let e=SearchAppWrapper.CortanaApp.createStringMap();e["Content-Type"]="application/json";let s=JSON.stringify(t.map(n=>({Smtp:n.email,PersonaType:"User"})));n.Async.safeChain("prefetchPeopleCards",()=>SearchAppWrapper.CortanaApp.makeHttpRequestAsync(1,o,f,s,e),n=>{if(n.statusCode!=200&&n.statusCode!=204){let t=new Error("Prefetch request failed with status code: "+n.statusCode);SharedLogHelper.LogError("prefetchPeopleCards",null,t)}})}})}buildPersonSuggestion(t,i,r,u,f,o,s,h){if(!i.EmailAddresses||!i.EmailAddresses[0])return null;const it=i.PeopleTy